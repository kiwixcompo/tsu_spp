================================================================================
QUICK DEPLOYMENT GUIDE - Staff Type, Visibility & Security
================================================================================

STEP 1: RUN DATABASE MIGRATIONS
================================
Run these SQL files in phpMyAdmin:

1. database/migrations/005_add_staff_type_and_unit.sql
   - Adds staff_type column (teaching/non-teaching)
   - Adds unit column (for non-teaching staff)

2. database/seeds/units_offices.sql
   - Creates units_offices table
   - Inserts 51 units/offices/directorates

================================================================================
STEP 2: UPLOAD NEW FILES
================================
Upload these NEW files:

1. config/security.php
   - Security configuration

2. app/Helpers/SecurityHelper.php
   - Security functions (file validation, XSS protection, etc.)

3. app/Views/auth/register_updated.php
   - New registration form with staff type & visibility

4. database/migrations/005_add_staff_type_and_unit.sql
5. database/seeds/units_offices.sql

================================================================================
STEP 3: CREATE LOGS DIRECTORY
================================
Create folder: storage/logs/
Set permissions: 755

This will store security event logs.

================================================================================
STEP 4: RENAME FILES
================================
Backup current register.php:
- Rename: app/Views/auth/register.php → register_old.php

Use new registration form:
- Rename: app/Views/auth/register_updated.php → register.php

================================================================================
STEP 5: UPDATE CONTROLLERS (REQUIRED)
================================
You need to update these controllers to handle new fields:

1. app/Controllers/AuthController.php - register() method
   Add validation for:
   - staff_type
   - profile_visibility
   - unit (for non-teaching)

2. app/Controllers/ProfileController.php - setup() method
   Add to profileData:
   - staff_type
   - unit
   - profile_visibility

3. app/Controllers/DirectoryController.php
   Update query to exclude private profiles

================================================================================
FEATURES IMPLEMENTED
================================

1. STAFF TYPE SELECTION
   - Teaching Staff: Must select Faculty & Department
   - Non-Teaching Staff: Must select Unit, Faculty/Dept optional
   - 51 units/offices/directorates available

2. PROFILE VISIBILITY
   - Public: Visible in directory (default)
   - Private: Hidden from directory
   - Toggle switch during registration

3. SECURITY ENHANCEMENTS
   - File upload validation (blocks exe, php, js, etc.)
   - MIME type verification
   - Malware detection
   - XSS protection
   - SQL injection prevention
   - CSRF protection
   - Security headers
   - Rate limiting
   - Activity logging

================================================================================
SECURITY FEATURES
================================

FILE UPLOAD SECURITY:
✅ Blocks dangerous extensions (exe, php, bat, js, etc.)
✅ Validates MIME types
✅ Checks for embedded PHP code in images
✅ Prevents double extensions (file.php.jpg)
✅ File size limits enforced
✅ Filename sanitization

INPUT SECURITY:
✅ XSS protection (HTML entity encoding)
✅ SQL injection prevention
✅ CSRF token validation
✅ Input length limits
✅ Special character filtering

SESSION SECURITY:
✅ Secure flag (HTTPS only)
✅ HttpOnly flag
✅ SameSite flag
✅ Session regeneration
✅ Session timeout

HEADERS SECURITY:
✅ X-Frame-Options
✅ X-Content-Type-Options
✅ X-XSS-Protection
✅ Content-Security-Policy
✅ Referrer-Policy

================================================================================
TESTING CHECKLIST
================================

REGISTRATION:
[ ] Staff type selection works
[ ] Teaching staff: Faculty/Department required
[ ] Non-teaching staff: Unit required
[ ] Profile visibility toggle works
[ ] Form validation works
[ ] Data saves correctly

SECURITY:
[ ] Cannot upload .exe files
[ ] Cannot upload .php files
[ ] Cannot upload files with PHP code
[ ] File size limits work
[ ] XSS attempts blocked
[ ] Security headers present

DIRECTORY:
[ ] Private profiles not shown
[ ] Public profiles shown
[ ] Search works
[ ] Filters work

================================================================================
IMPORTANT NOTES
================================

1. BACKUP DATABASE before running migrations
2. TEST on local/staging environment first
3. Monitor storage/logs/security.log for suspicious activity
4. Update .htaccess if needed for security headers
5. Ensure HTTPS is enabled for secure cookies

================================================================================
SUPPORT FILES
================================

IMPLEMENTATION_PLAN.md - Detailed implementation guide
config/security.php - Security configuration
app/Helpers/SecurityHelper.php - Security functions
app/Views/auth/register_updated.php - New registration form

================================================================================
ESTIMATED TIME
================================

- Database setup: 15 minutes
- File upload: 10 minutes
- Controller updates: 30 minutes
- Testing: 30 minutes
TOTAL: ~1.5 hours

================================================================================
NEED HELP?
================================

Check these files for details:
- IMPLEMENTATION_PLAN.md (comprehensive guide)
- config/security.php (security settings)
- app/Helpers/SecurityHelper.php (security functions)

Monitor logs:
- storage/logs/security.log (security events)
- error.log (PHP errors)

================================================================================
